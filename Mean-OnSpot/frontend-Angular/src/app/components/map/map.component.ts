import { Component, OnInit, Output, EventEmitter } from '@angular/core';
import { GoogleMapsAPIWrapper, AgmMap, LatLngBounds, LatLngBoundsLiteral} from '@agm/core';
import { PaymentServiceService } from 'src/app/services/payment-service.service';




@Component({
  selector: 'app-map',
  templateUrl: './map.component.html',
  styleUrls: ['./map.component.css']
})
export class MapComponent implements OnInit {
  // map: mapboxgl.Map;
  // style = 'mapbox://styles/mapbox/streets-v11';
  mapStyle = [
    {
      "elementType": "geometry",
      "stylers": [
        {
          "color": "#ebe3cd"
        }
      ]
    },
    {
      "elementType": "labels.text.fill",
      "stylers": [
        {
          "color": "#523735"
        }
      ]
    },
    {
      "elementType": "labels.text.stroke",
      "stylers": [
        {
          "color": "#f5f1e6"
        }
      ]
    },
    {
      "featureType": "administrative",
      "elementType": "geometry.stroke",
      "stylers": [
        {
          "color": "#c9b2a6"
        }
      ]
    },
    {
      "featureType": "administrative.land_parcel",
      "elementType": "geometry.stroke",
      "stylers": [
        {
          "color": "#dcd2be"
        }
      ]
    },
    {
      "featureType": "administrative.land_parcel",
      "elementType": "labels.text.fill",
      "stylers": [
        {
          "color": "#ae9e90"
        }
      ]
    },
    {
      "featureType": "landscape.natural",
      "elementType": "geometry",
      "stylers": [
        {
          "color": "#dfd2ae"
        }
      ]
    },
    {
      "featureType": "poi",
      "elementType": "geometry",
      "stylers": [
        {
          "color": "#dfd2ae"
        }
      ]
    },
    {
      "featureType": "poi",
      "elementType": "labels.text.fill",
      "stylers": [
        {
          "color": "#93817c"
        }
      ]
    },
    {
      "featureType": "poi.business",
      "stylers": [
        {
          "visibility": "off"
        }
      ]
    },
    {
      "featureType": "poi.park",
      "elementType": "geometry.fill",
      "stylers": [
        {
          "color": "#a5b076"
        }
      ]
    },
    {
      "featureType": "poi.park",
      "elementType": "labels.text.fill",
      "stylers": [
        {
          "color": "#447530"
        }
      ]
    },
    {
      "featureType": "road",
      "elementType": "geometry",
      "stylers": [
        {
          "color": "#f5f1e6"
        }
      ]
    },
    {
      "featureType": "road",
      "elementType": "labels.icon",
      "stylers": [
        {
          "visibility": "off"
        }
      ]
    },
    {
      "featureType": "road.arterial",
      "elementType": "geometry",
      "stylers": [
        {
          "color": "#fdfcf8"
        }
      ]
    },
    {
      "featureType": "road.highway",
      "elementType": "geometry",
      "stylers": [
        {
          "color": "#f8c967"
        }
      ]
    },
    {
      "featureType": "road.highway",
      "elementType": "geometry.stroke",
      "stylers": [
        {
          "color": "#e9bc62"
        }
      ]
    },
    {
      "featureType": "road.highway.controlled_access",
      "elementType": "geometry",
      "stylers": [
        {
          "color": "#e98d58"
        }
      ]
    },
    {
      "featureType": "road.highway.controlled_access",
      "elementType": "geometry.stroke",
      "stylers": [
        {
          "color": "#db8555"
        }
      ]
    },
    {
      "featureType": "road.local",
      "elementType": "labels.text.fill",
      "stylers": [
        {
          "color": "#806b63"
        }
      ]
    },
    {
      "featureType": "transit",
      "stylers": [
        {
          "visibility": "off"
        }
      ]
    },
    {
      "featureType": "transit.line",
      "elementType": "geometry",
      "stylers": [
        {
          "color": "#dfd2ae"
        }
      ]
    },
    {
      "featureType": "transit.line",
      "elementType": "labels.text.fill",
      "stylers": [
        {
          "color": "#8f7d77"
        }
      ]
    },
    {
      "featureType": "transit.line",
      "elementType": "labels.text.stroke",
      "stylers": [
        {
          "color": "#ebe3cd"
        }
      ]
    },
    {
      "featureType": "transit.station",
      "elementType": "geometry",
      "stylers": [
        {
          "color": "#dfd2ae"
        }
      ]
    },
    {
      "featureType": "water",
      "elementType": "geometry.fill",
      "stylers": [
        {
          "color": "#b9d3c2"
        }
      ]
    },
    {
      "featureType": "water",
      "elementType": "labels.text.fill",
      "stylers": [
        {
          "color": "#92998d"
        }
      ]
    }
  ]
  public lat =  38.73674521461237;
  public lng =  -9.1386079788208;

  public parkedLat;
  public parkedLng;
  public mapZoom = 15;

  public parked = false;
  public zone;

  //bastante badalhoco click on '-' to not see this
  public Zones: Object = {
    "type": "FeatureCollection",
    "features": [
      {
        "type": "Feature",
        "properties": {
          "zone": "Av. João XXI",
          "charge": "1.20",
          "color": "Amarela",
          "spots": "100"
        },
        "geometry": {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -9.14088249206543,
                38.73788336317147
              ],
              [
                -9.138565063476562,
                38.73835200730645
              ],
              [
                -9.136762619018553,
                38.73774946428237
              ],
              [
                -9.136505126953125,
                38.737448190864036
              ],
              [
                -9.133973121643066,
                38.73761556514222
              ],
              [
                -9.133672714233398,
                38.739255812311086
              ],
              [
                -9.134659767150879,
                38.739523604189955
              ],
              [
                -9.134659767150879,
                38.73999223756174
              ],
              [
                -9.133672714233398,
                38.73989181638382
              ],
              [
                -9.133501052856445,
                38.74109686119914
              ],
              [
                -9.131269454956055,
                38.745983778934686
              ],
              [
                -9.145517349243164,
                38.74518047296261
              ],
              [
                -9.142084121704102,
                38.73917212714299
              ],
              [
                -9.142427444458008,
                38.739038230670104
              ],
              [
                -9.142169952392578,
                38.737799676395184
              ],
              [
                -9.141011238098145,
                38.73793357519016
              ],
              [
                -9.14088249206543,
                38.73788336317147
              ]
            ]
          ]
        }
      },
      {
        "type": "Feature",
        "properties": {
          "zone": "Campo Pequeno",
          "charge": "1.20",
          "color": "Amarela",
          "spots": "80"
        },
        "geometry": {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -9.142202138900757,
                38.737799676395184
              ],
              [
                -9.142448902130127,
                38.739088441876866
              ],
              [
                -9.1421377658844,
                38.73919723270372
              ],
              [
                -9.145528078079224,
                38.74518047296261
              ],
              [
                -9.147491455078123,
                38.74484575947351
              ],
              [
                -9.14637565612793,
                38.74015960587783
              ],
              [
                -9.1456139087677,
                38.737255709959214
              ],
              [
                -9.142202138900757,
                38.737799676395184
              ]
            ]
          ]
        }
      },
      {
        "type": "Feature",
        "properties": {
          "zone": "Estefânia",
          "charge": "1.20",
          "color": "Amarela",
          "spots": "97"
        },
        "geometry": {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -9.1456139087677,
                38.737255709959214
              ],
              [
                -9.145002365112305,
                38.73430148143083
              ],
              [
                -9.144487380981445,
                38.734134099386395
              ],
              [
                -9.144272804260254,
                38.73393324041529
              ],
              [
                -9.144401550292969,
                38.733531520778705
              ],
              [
                -9.141011238098145,
                38.73158984401968
              ],
              [
                -9.140753746032715,
                38.731690276870516
              ],
              [
                -9.14113998413086,
                38.7330293680559
              ],
              [
                -9.138479232788086,
                38.73282850597838
              ],
              [
                -9.137020111083984,
                38.734569291886125
              ],
              [
                -9.136419296264648,
                38.73649414998851
              ],
              [
                -9.136526584625244,
                38.73746492830949
              ],
              [
                -9.136784076690674,
                38.73776620165722
              ],
              [
                -9.138575792312622,
                38.73835200730645
              ],
              [
                -9.14089322090149,
                38.73788336317147
              ],
              [
                -9.141032695770264,
                38.73793357519016
              ],
              [
                -9.1456139087677,
                38.737255709959214
              ]
            ]
          ]
        }
      },
      {
        "type": "Feature",
        "properties": {
          "zone": "Berna/Valmor",
          "charge": "1.20",
          "color": "Amarela",
          "spots": "77"
        },
        "geometry": {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -9.146676063537598,
                38.741347909642876
              ],
              [
                -9.148693084716797,
                38.741029914798396
              ],
              [
                -9.15311336517334,
                38.73898801942805
              ],
              [
                -9.152555465698242,
                38.73825158382212
              ],
              [
                -9.152169227600098,
                38.73497100568634
              ],
              [
                -9.145190119743345,
                38.735171861739225
              ],
              [
                -9.14562463760376,
                38.73727244744978
              ],
              [
                -9.146676063537598,
                38.741347909642876
              ]
            ]
          ]
        }
      },
      {
        "type": "Feature",
        "properties": {
          "zone": "Avenidas Novas",
          "charge": "1.20",
          "color": "Amarela",
          "spots": "63"
        },
        "geometry": {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -9.152179956436155,
                38.73498774371232
              ],
              [
                -9.153907299041746,
                38.734360065053735
              ],
              [
                -9.148521423339842,
                38.72794068800838
              ],
              [
                -9.145216941833496,
                38.733330660113175
              ],
              [
                -9.144734144210815,
                38.73332229090655
              ],
              [
                -9.144412279129028,
                38.73353988996086
              ],
              [
                -9.144283533096313,
                38.73394160955037
              ],
              [
                -9.144487380981445,
                38.734134099386395
              ],
              [
                -9.145013093948364,
                38.73430985052276
              ],
              [
                -9.145216941833496,
                38.735171861739225
              ],
              [
                -9.152179956436155,
                38.73498774371232
              ]
            ]
          ]
        }
      },
      {
        "type": "Feature",
        "properties": {
          "zone": "Parque",
          "charge": "1.60",
          "color": "Vermelha",
          "spots": "43"
        },
        "geometry": {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -9.153912663459778,
                38.734368434138794
              ],
              [
                -9.154422283172607,
                38.73383281071796
              ],
              [
                -9.154513478279114,
                38.7335691820906
              ],
              [
                -9.152909517288208,
                38.7316484298665
              ],
              [
                -9.152780771255493,
                38.73158147460909
              ],
              [
                -9.152566194534302,
                38.731380608460256
              ],
              [
                -9.149004220962524,
                38.727405016391536
              ],
              [
                -9.148526787757874,
                38.72794278046775
              ],
              [
                -9.153912663459778,
                38.734368434138794
              ]
            ]
          ]
        }
      },
      {
        "type": "Feature",
        "properties": {
          "zone": "Roma",
          "charge": "0.80",
          "color": "Verde",
          "spots": "41"
        },
        "geometry": {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -9.131274819374084,
                38.745983778934686
              ],
              [
                -9.131054878234863,
                38.74876180908016
              ],
              [
                -9.141976833343506,
                38.74927640219556
              ],
              [
                -9.139927625656126,
                38.7454942654336
              ],
              [
                -9.131274819374084,
                38.745983778934686
              ]
            ]
          ]
        }
      },
      {
        "type": "Feature",
        "properties": {
          "zone": "Bairro S. Miguel",
          "charge": "0.80",
          "color": "Verde",
          "spots": "58"
        },
        "geometry": {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -9.141998291015625,
                38.74931405520473
              ],
              [
                -9.148693084716797,
                38.748276498353235
              ],
              [
                -9.147491455078123,
                38.74486249518524
              ],
              [
                -9.1455602645874,
                38.745230679850636
              ],
              [
                -9.139959812164307,
                38.74553192043746
              ],
              [
                -9.141998291015625,
                38.74931405520473
              ]
            ]
          ]
        }
      },
      {
        "type": "Feature",
        "properties": {
          "zone": "Entrecampos",
          "charge": "0.80",
          "color": "Verde",
          "spots": "89"
        },
        "geometry": {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -9.146697521209717,
                38.741381382702045
              ],
              [
                -9.147512912750244,
                38.74485412732986
              ],
              [
                -9.148693084716797,
                38.748280682080484
              ],
              [
                -9.150238037109375,
                38.74802547426893
              ],
              [
                -9.150710105895996,
                38.74974915520319
              ],
              [
                -9.15137529373169,
                38.74959854396535
              ],
              [
                -9.151268005371094,
                38.74907976949178
              ],
              [
                -9.151761531829834,
                38.74891242208322
              ],
              [
                -9.151482582092285,
                38.747941799378026
              ],
              [
                -9.156632423400879,
                38.747038104307435
              ],
              [
                -9.15536642074585,
                38.74590010165094
              ],
              [
                -9.154642224311829,
                38.74390436937326
              ],
              [
                -9.153960943222046,
                38.74296296686167
              ],
              [
                -9.152383804321287,
                38.743762113789764
              ],
              [
                -9.152137041091917,
                38.74384579357908
              ],
              [
                -9.152061939239502,
                38.743967129099424
              ],
              [
                -9.152158498764038,
                38.74417214382042
              ],
              [
                -9.151777625083923,
                38.74498382897791
              ],
              [
                -9.150774478912354,
                38.74451941231094
              ],
              [
                -9.150468707084656,
                38.74446920492277
              ],
              [
                -9.149540662765503,
                38.74457380360828
              ],
              [
                -9.14936363697052,
                38.74389181742141
              ],
              [
                -9.14959967136383,
                38.74384160959196
              ],
              [
                -9.149546027183533,
                38.74362822592289
              ],
              [
                -9.15111780166626,
                38.74289602221041
              ],
              [
                -9.149953722953796,
                38.74156548424692
              ],
              [
                -9.150372147560118,
                38.74129351588829
              ],
              [
                -9.149803519248962,
                38.7405319989738
              ],
              [
                -9.148698449134827,
                38.74103828310192
              ],
              [
                -9.146697521209717,
                38.741381382702045
              ]
            ]
          ]
        }
      },
      {
        "type": "Feature",
        "properties": {
          "zone": "Rio de Janeiro",
          "charge": "0.8",
          "color": "Verde",
          "spots": "72"
        },
        "geometry": {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -9.141976833343506,
                38.74928476953266
              ],
              [
                -9.137492179870605,
                38.74907140213065
              ],
              [
                -9.13738489151001,
                38.751573199411816
              ],
              [
                -9.138994216918945,
                38.754769347975106
              ],
              [
                -9.144036769866943,
                38.75306252204569
              ],
              [
                -9.141976833343506,
                38.74928476953266
              ]
            ]
          ]
        }
      },
      {
        "type": "Feature",
        "properties": {
          "zone": "Av. da Igreja",
          "charge": "0.80",
          "color": "Verde",
          "spots": "56"
        },
        "geometry": {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -9.142019748687744,
                38.749322422537375
              ],
              [
                -9.145903587341309,
                38.75668529512561
              ],
              [
                -9.151139259338379,
                38.754995248348564
              ],
              [
                -9.148263931274414,
                38.749606911264664
              ],
              [
                -9.148060083389282,
                38.74838527518231
              ],
              [
                -9.142019748687744,
                38.749322422537375
              ]
            ]
          ]
        }
      },
      {
        "type": "Feature",
        "properties": {
          "zone": "Campo Grande",
          "charge": "0.80",
          "color": "Verde",
          "spots": "100"
        },
        "geometry": {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -9.148081541061401,
                38.74839364262384
              ],
              [
                -9.148285388946533,
                38.749590176665045
              ],
              [
                -9.151160717010498,
                38.754995248348564
              ],
              [
                -9.15285587310791,
                38.75439284576394
              ],
              [
                -9.154572486877441,
                38.756024341002494
              ],
              [
                -9.15809154510498,
                38.75497014834236
              ],
              [
                -9.15885329246521,
                38.755154214849426
              ],
              [
                -9.160569906234741,
                38.75458528047555
              ],
              [
                -9.156632423400879,
                38.74705483950528
              ],
              [
                -9.151493310928345,
                38.747958534364074
              ],
              [
                -9.151772260665894,
                38.74892915684175
              ],
              [
                -9.151278734207153,
                38.74909650421107
              ],
              [
                -9.151386022567749,
                38.74961527856301
              ],
              [
                -9.150720834732056,
                38.74974915520319
              ],
              [
                -9.150227308273315,
                38.748050576717084
              ],
              [
                -9.148081541061401,
                38.74839364262384
              ]
            ]
          ]
        }
      },
      {
        "type": "Feature",
        "properties": {
          "zone": "Praça José Fontana",
          "charge": "1.20",
          "color": "Amarela",
          "spots": "45"
        },
        "geometry": {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -9.148221015930176,
                38.72845961605723
              ],
              [
                -9.14785623550415,
                38.72794068800838
              ],
              [
                -9.146997928619383,
                38.72571427650825
              ],
              [
                -9.1461181640625,
                38.72472659806434
              ],
              [
                -9.146096706390379,
                38.72578123726451
              ],
              [
                -9.143521785736084,
                38.72773981162272
              ],
              [
                -9.140582084655762,
                38.72760589371852
              ],
              [
                -9.14036750793457,
                38.729229631377216
              ],
              [
                -9.140879809856415,
                38.73164424516476
              ],
              [
                -9.141011238098145,
                38.73159193637218
              ],
              [
                -9.144412279129028,
                38.733535705369896
              ],
              [
                -9.144734144210815,
                38.73332229090655
              ],
              [
                -9.145219624042511,
                38.733330660113175
              ],
              [
                -9.148221015930176,
                38.72845961605723
              ]
            ]
          ]
        }
      },
      {
        "type": "Feature",
        "properties": {
          "zone": "Santa Marta ",
          "charge": "1.20",
          "color": "Amarela",
          "spots": "83"
        },
        "geometry": {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -9.148215651512146,
                38.72844078405688
              ],
              [
                -9.148518741130827,
                38.72794068800838
              ],
              [
                -9.14900690317154,
                38.727405016391536
              ],
              [
                -9.149808883666992,
                38.726057449720756
              ],
              [
                -9.149283170700073,
                38.72583145779053
              ],
              [
                -9.149004220962524,
                38.72539621205908
              ],
              [
                -9.148682355880737,
                38.72532088079793
              ],
              [
                -9.144787788391113,
                38.720876195817276
              ],
              [
                -9.1446053981781,
                38.72096827307492
              ],
              [
                -9.143795371055601,
                38.71987589432773
              ],
              [
                -9.14310336112976,
                38.72039488094865
              ],
              [
                -9.142529368400574,
                38.72071296765987
              ],
              [
                -9.14287269115448,
                38.72103523827869
              ],
              [
                -9.143446683883667,
                38.72141610168178
              ],
              [
                -9.14383292198181,
                38.72195181819781
              ],
              [
                -9.144288897514343,
                38.72324086960606
              ],
              [
                -9.144288897514343,
                38.72334549938187
              ],
              [
                -9.143564701080322,
                38.72333712900546
              ],
              [
                -9.143575429916382,
                38.72339990680475
              ],
              [
                -9.145672917366028,
                38.72335386975732
              ],
              [
                -9.145962595939636,
                38.7243415671759
              ],
              [
                -9.14612352848053,
                38.72472659806434
              ],
              [
                -9.147003293037415,
                38.72572264660622
              ],
              [
                -9.147861599922178,
                38.72794487292707
              ],
              [
                -9.148215651512146,
                38.72844078405688
              ]
            ]
          ]
        }
      },
      {
        "type": "Feature",
        "properties": {
          "zone": "Campo Santana",
          "charge": "1.20",
          "color": "Amarela",
          "spots": "40"
        },
        "geometry": {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -9.140592813491821,
                38.72760170877996
              ],
              [
                -9.143521785736084,
                38.72774399655319
              ],
              [
                -9.14610207080841,
                38.72578960735462
              ],
              [
                -9.14612889289856,
                38.72472241295714
              ],
              [
                -9.145967960357666,
                38.72434575230539
              ],
              [
                -9.145678281784058,
                38.7233622401318
              ],
              [
                -9.143575429916382,
                38.72340827717381
              ],
              [
                -9.143580794334412,
                38.72333712900546
              ],
              [
                -9.144294261932373,
                38.72335386975732
              ],
              [
                -9.144294261932373,
                38.72323249921738
              ],
              [
                -9.143843650817871,
                38.7219601887365
              ],
              [
                -9.143446683883667,
                38.72142865758361
              ],
              [
                -9.142540097236633,
                38.72072133834368
              ],
              [
                -9.141912460327148,
                38.720625075420706
              ],
              [
                -9.14137601852417,
                38.72032372978001
              ],
              [
                -9.140174388885496,
                38.72030698831826
              ],
              [
                -9.13935899734497,
                38.720574851235504
              ],
              [
                -9.139251708984375,
                38.72234941770309
              ],
              [
                -9.140753746032715,
                38.72584819795801
              ],
              [
                -9.140592813491821,
                38.72760170877996
              ]
            ]
          ]
        }
      },
      {
        "type": "Feature",
        "properties": {
          "zone": "Chile",
          "charge": "1.20",
          "color": "Amarela", 
          "spots": "55"
        },
        "geometry": {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -9.140753746032715,
                38.731698646268384
              ],
              [
                -9.14088249206543,
                38.731642152813784
              ],
              [
                -9.140678644180298,
                38.73057713821701
              ],
              [
                -9.13963794708252,
                38.730736159086604
              ],
              [
                -9.138200283050537,
                38.73055202962631
              ],
              [
                -9.136183261871338,
                38.73061898584861
              ],
              [
                -9.13611888885498,
                38.729664853756496
              ],
              [
                -9.134659767150879,
                38.72959789663996
              ],
              [
                -9.134788513183594,
                38.72830059012025
              ],
              [
                -9.133608341217041,
                38.728216892116485
              ],
              [
                -9.132653474807737,
                38.728568423073355
              ],
              [
                -9.131923913955688,
                38.72820852231071
              ],
              [
                -9.131505489349365,
                38.728267110930496
              ],
              [
                -9.131226539611816,
                38.728216892116485
              ],
              [
                -9.131011962890625,
                38.72781514033352
              ],
              [
                -9.13063645362854,
                38.727823510185395
              ],
              [
                -9.130722284317015,
                38.72822526192126
              ],
              [
                -9.130926132202147,
                38.72850983470067
              ],
              [
                -9.131312370300293,
                38.72897854033697
              ],
              [
                -9.13137674331665,
                38.729388655246275
              ],
              [
                -9.130969047546385,
                38.72994105119892
              ],
              [
                -9.130797386169434,
                38.7299828992031
              ],
              [
                -9.130947589874268,
                38.73278665964114
              ],
              [
                -9.137020111083984,
                38.734577660946684
              ],
              [
                -9.138500690460205,
                38.73282850597838
              ],
              [
                -9.14113998413086,
                38.73304610653687
              ],
              [
                -9.140753746032715,
                38.731698646268384
              ]
            ]
          ]
        }
      },
      {
        "type": "Feature",
        "properties": {
          "zone": "Anjos",
          "charge": "0.80",
          "color": "Verde",
          "spots": "80"
        },
        "geometry": {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -9.14064645767212,
                38.73056876868774
              ],
              [
                -9.1403728723526,
                38.72924218590605
              ],
              [
                -9.140592813491821,
                38.72760170877996
              ],
              [
                -9.140764474868774,
                38.72586075308105
              ],
              [
                -9.139251708984375,
                38.722353602949305
              ],
              [
                -9.139278531074524,
                38.722064820387494
              ],
              [
                -9.138731360435486,
                38.72224060121627
              ],
              [
                -9.13838803768158,
                38.72224897172115
              ],
              [
                -9.136821627616882,
                38.72347105491062
              ],
              [
                -9.136220812797546,
                38.723320388249654
              ],
              [
                -9.135764837265015,
                38.72342501790903
              ],
              [
                -9.135577082633972,
                38.723010683560034
              ],
              [
                -9.13515329360962,
                38.722596346808594
              ],
              [
                -9.132653474807737,
                38.722487530697755
              ],
              [
                -9.132449626922606,
                38.72289768286607
              ],
              [
                -9.131709337234495,
                38.72331201787029
              ],
              [
                -9.131795167922974,
                38.723609165737415
              ],
              [
                -9.130228757858275,
                38.726304366012585
              ],
              [
                -9.13063108921051,
                38.727823510185395
              ],
              [
                -9.131011962890625,
                38.72781932525959
              ],
              [
                -9.131231904029846,
                38.72821270721372
              ],
              [
                -9.131510853767395,
                38.728262926030666
              ],
              [
                -9.131918549537659,
                38.72820852231071
              ],
              [
                -9.132658839225769,
                38.728568423073355
              ],
              [
                -9.13359761238098,
                38.728221077018986
              ],
              [
                -9.134793877601624,
                38.72830059012025
              ],
              [
                -9.134675860404968,
                38.72959789663996
              ],
              [
                -9.13611352443695,
                38.729673223391664
              ],
              [
                -9.136183261871338,
                38.73061480108653
              ],
              [
                -9.138194918632507,
                38.73054784486034
              ],
              [
                -9.139648675918579,
                38.73074034384155
              ],
              [
                -9.14064645767212,
                38.73056876868774
              ]
            ]
          ]
        }
      },
      {
        "type": "Feature",
        "properties": {
          "zone": "Alameda",
          "charge": "0.80",
          "color": "Verde",
          "spots": "76"
        },
        "geometry": {
          "type": "Polygon",
          "coordinates": [
            [
              [
                -9.130942225456238,
                38.732799213544865
              ],
              [
                -9.131054878234863,
                38.73307539886914
              ],
              [
                -9.130416512489319,
                38.73341853672385
              ],
              [
                -9.130330681800842,
                38.73684982461182
              ],
              [
                -9.129536747932434,
                38.736925143716554
              ],
              [
                -9.129230976104736,
                38.737109256749335
              ],
              [
                -9.129161238670347,
                38.737326844267066
              ],
              [
                -9.128801822662354,
                38.73734776610883
              ],
              [
                -9.128522872924805,
                38.737297553678296
              ],
              [
                -9.127192497253418,
                38.73774946428237
              ],
              [
                -9.127235412597656,
                38.73821810929596
              ],
              [
                -9.126849174499512,
                38.73841895621757
              ],
              [
                -9.128286838531494,
                38.741163807537085
              ],
              [
                -9.12912368774414,
                38.74161569367677
              ],
              [
                -9.130303859710693,
                38.74198389508377
              ],
              [
                -9.132975339889526,
                38.74225167673276
              ],
              [
                -9.13350373506546,
                38.74109476912505
              ],
              [
                -9.133675396442413,
                38.73989390849312
              ],
              [
                -9.134665131568909,
                38.73999223756174
              ],
              [
                -9.134659767150879,
                38.73952569631005
              ],
              [
                -9.133672714233398,
                38.739257904439015
              ],
              [
                -9.133975803852081,
                38.73761765731821
              ],
              [
                -9.136518537998198,
                38.73745446740652
              ],
              [
                -9.136416614055634,
                38.73649414998851
              ],
              [
                -9.137014746665955,
                38.734577660946684
              ],
              [
                -9.130942225456238,
                38.732799213544865
              ]
            ]
          ]
        }
      }
    ]
  };
  
  zoneData

  @Output() messageEvent = new EventEmitter<object>();

  constructor(private paymentService: PaymentServiceService) { 
  }

  ngOnInit() {
    //this should be in the database
    if(this.paymentService.getParkingInformations()){
      this.parked = true;
      var a = this.paymentService.getParkingInformations();

      for(let feature in this.Zones)
        console.log(this.Zones.features);
         
      
      for(var i=0; i< Object.keys(this.Zones.features).length; i++){
        if(this.Zones.features[i].properties.zone == a.zoneTitle){
          this.Zones.features[i].properties.spots = parseInt(this.Zones.features[i].properties.spots) - 1;

          var lt = 0;
          var lg = 0;
          //find the average point of a zone
          console.log(this.Zones.features[i].geometry.coordinates[0]);
          
          for(var j = 0; j < this.Zones.features[i].geometry.coordinates[0].length; j++){
            lg += this.Zones.features[i].geometry.coordinates[0][j][0];
            lt += this.Zones.features[i].geometry.coordinates[0][j][1];
          }
          this.parkedLng = lg/this.Zones.features[i].geometry.coordinates[0].length;
          this.parkedLat = lt/this.Zones.features[i].geometry.coordinates[0].length;
          this.lat = this.parkedLat;
          this.lng = this.parkedLng;
          break;
        }
      }
    }
  }

  onZoneClick(event){
    this.zoneData = {
      "zoneTitle": event.feature.h.zone, 
      "zoneCharge": event.feature.h.charge, 
      "zoneColor": event.feature.h.color,
      "parkingSpots": event.feature.getProperty('spots')
    }
    
    this.messageEvent.emit(this.zoneData);
    for(var i=0; i< Object.keys(this.Zones.features).length; i++){
      
      if(this.Zones.features[i].properties.zone == this.zoneData.zoneTitle){
        this.zone = this.Zones.features[i];
        break;
      }
    }
    
    var lt = 0;
    var lg = 0;
    //find the average point of a zone
    for(var i = 0; i < this.zone.geometry.coordinates[0].length; i++){
      lg += this.zone.geometry.coordinates[0][i][0];
      lt += this.zone.geometry.coordinates[0][i][1];
    }
    
    this.lng = lg/this.zone.geometry.coordinates[0].length;
    this.lat = lt/this.zone.geometry.coordinates[0].length;
  }

  styleFunc(feature) {
    if(feature.getProperty('color') == 'Amarela')
      return ({ fillColor: 'yellow', strokeWeight: 1})
    else if(feature.getProperty('color') == 'Verde')
      return ({ fillColor: 'green', strokeWeight: 1})
    else if(feature.getProperty('color') == 'Vermelha')
      return ({ fillColor: 'red', strokeWeight: 1})
    }
    

  onChoseLocation(event){
    console.log(event);
    
    this.lat = event.coords.lat;
    this.lng = event.coords.lng;
  }

  zoomChange(event){
    console.log(event);
    this.mapZoom = event;
  }

  zoneParkingCommited(spotNumber:number, event){
    var spots = event.feature.getProperty('spots')
    event.feature.setProperty('spots', spots + spotNumber);
    console.log(event.feature.getProperty('spots'));
    
  }

  //returns the mid point of the zone
  latMid(item){
    var lt = 0;
    for(var j = 0; j < item.geometry.coordinates[0].length; j++){
          lt += item.geometry.coordinates[0][j][1];
        }
    return lt/item.geometry.coordinates[0].length;
  }

  lngMid(item){
    
    var lg = 0;
    for(var j = 0; j < item.geometry.coordinates[0].length; j++){
          lg += item.geometry.coordinates[0][j][0];
        }

    
    return lg/item.geometry.coordinates[0].length;
  }

  fontSize(){
    console.log(5*this.mapZoom/12);
    
    return 5*this.mapZoom/12
  }
}
